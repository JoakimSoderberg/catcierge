{"name":"Catcierge","tagline":"Image recognition (to keep cat prey out) and RFID chip reader system for automated DIY cat door.","body":"The short version\r\n=================\r\nThe Catcierge project is an image recognition and cat RFID-chip reader for detecting \"gifts\" (dead or alive) and neighbour cats, made to work together with an automated cat door system. Designed for use with the Raspberry Pi including camera board (but can easily be modified to work on other systems as well).\r\n\r\nBackground\r\n==========\r\nThe Catcierge project came about to solve the problem of our cat having the nasty habit of delivering \"gifts\" to us through our cat door in the form of dead, or partly dead / fully alive rodents or birds.\r\n\r\nInstead of simply not allowing our cat to use the cat door like normal people I of course set out to find a high-tech solution to solve my perdicament.\r\n\r\nMy idea was to somehow use image recognition to lock the cat door if it had something in it's mouth. My first idea was to use Haar Cascades as is normally used for facial recognition, but instead train it to work on cats.\r\n\r\nIn the process of researching possible solutions I found the Flo Control project that instead uses a controlled envrionment to get a good profile image of the cat where the \"gift\" easily can be distingusihed. I decided to implement this idea instead.\r\n\r\nDevelopment story\r\n=================\r\nAfter replacing the window in our basement stairway with a cat door to let our cat Higgs live a more free roaming life, she soon started delivering dead (and some living) rodents and birds. Obviously this is not something we want so I decided to build an automated cat door that will shut her out when she tries to bring them inside.\r\n\r\nWhen first installing the cat door I was also worried about other neighbouring cats making visits through it (especially since, we'd had some visits when we kept our door open in the summe before our cat had time to mark her territory), so I had some plans to create an automated door that solves that problem as well, by reading the RFID chip our cat has operated into her neck. \r\n\r\nI had seen several DIY solutions of RFID readers that require the cat to wear an extra RFID chip on a collar, but that's not what I wanted. So my idea was to find a reader that supports reading the actual [ISO 11784/11785, FDX/HDX tags](http://en.wikipedia.org/wiki/ISO_11784_%26_11785) which uses another frequency compared to most generic RFID readers.\r\n\r\nThe [Rapsberry Pi][rpi]\r\n-----------------------\r\nWhen I started thinking of this project the Raspberry Pi had become available, as well as the [camera board][rpi_cam]. So I quickly decided I will use this for my project. \r\n\r\nOne problem was that [OpenCV][opencv] does not work natively with the Raspberry Pi camera which interfaces directly via the CPU. Thankfully [Pierre Raufast][rpi_opencv] fixed this problem by rewriting the raspistill program to work with OpenCV, and [Emil Valkov][emil_valkov]Â simplified this into a library that can easily be used with an API similar to the normal OpenCV camera API.\r\n\r\nBuilding the cat door\r\n---------------------\r\nThe cat door we built and installed as a replacement for our basement window was kind of a temporary solution. At first we had simply thought we would remove it for the winter and put the normal window back in since we live in northern Sweden where it easily can go down to -30C.\r\n\r\nHowever, since I was thinking of building this automated cat door which obvisouly would need some extra space to fit, I instead decided to build a small house in front of the cat door that's insulated so we wouldn't loose too much heat through it as well.\r\n\r\nMy idea was to have the cat first go through a small corridor that I would build in front of this small cat house, and at the end of this corridor a first cat door would be installed. This would be the cat door that I could lock automatically if any prey was detected. \r\n\r\nThis design would also have the benefit of insulating the outside from the inside via two cat doors, instead of just one. I could also put in a third door at the beginning of this corridor to get even less cold air flowing in.\r\n\r\nTo make it easier to develop this thing, I built the corridor in a way that made it removable, so I could easily bring it in while developing the software and testing the door locking and such. I built the frame of it in place in front of the cat house, and made it fit into it's opening.\r\n\r\nThe idea for this \"capture\" corridor was to keep the camera and electronics in half of it, and then make a small passage for the cat to actually go through in the other half. The corridor therefore needs to be wide enough so that the camera, with it's field of view, can get a good enough picture of the cats profile. \r\n\r\nTo decide how far away the camera needed to be I persuaded my cat to keep still in front of the camera att different distances (not as easy as it sounds). The optimal distance turned out to be about 30cm. So I decided making the corridor 60cm would be enough to fit everything.\r\n\r\nLocking mechanism\r\n-----------------\r\nThe actual cat door I decided to use was a very simple store bought one with some manual plastic locking latches. I was not interested in using these for the actual locking, or buying some fancy expensive cat door with a built-in electronic locking mechanism.\r\n\r\nInstead my idea all a long was to use a 12V solenoid that when given power will push a small pin out. This pin will then block the door so it cannot be opened. My first idea was to build my own circuit to control this solenoid via the 3.3v [Raspberry Pi][rpi] GPIO pins. Since the solenoid requires a 12V power supply, it cannot be directly controlled via the GPIO pins.\r\n\r\nAfter doing some googling, I instead found a nice and cheap board named [Picoborg][picoborg] that lets you connect an external power supply (in my case a 12V one), and then control up to 4 devices using the RPI GPIO pins.\r\n\r\nTo attach the solenoid next to the cat door I used my band saw to create a piece of wood that would hold it in place.\r\n\r\nMethod of detecting\r\n-------------------\r\nSince I had found the [Flo Control project][flo_control] that had solved the problem with detecting cat prey, I knew a working method in theory for how I could detect the cats face and eventual prey. \r\n\r\nThe basic idea is to make the cat go through a corridor. On one side of the corridor there's a camera, on the other side there's a backlight. This enables us to take a well controlled picture of the cats profile. Since cats keep their prey in the mouth, we can focus on the cats snout when doing the matching. We now use a saved image of the cats snout without any prey in it, and scan the image for that, if we get a good enough match, we can be certain the cat has no prey, if not we lock the door!\r\n\r\nThis method is a lot simpler than using more advanced techniques used for pattern matching, such as haar cascades or similar things normally used for facial detection in humans. Using techniques like that it would probably be possible to make a much more compact version with the camera simply being placed above the cat door, and taking a picture of the cat face on. However, that would require a lot more time and effort, involving different lightning and weather. Keep It Simple Stupid!\r\n\r\nBacklight\r\n---------\r\nSince the detection method I choose for this solution requires a backlight, I decided to use a 12V LED light that I then also can connect to the [Picoborg][picoborg] and be able to control it via the RPI GPIO pins. First I tried using a normal LED light for this, but it turned out that the background would not be uniform enough, giving me a bad profile picture.\r\n\r\nInstead I decided to tape a cheap 5m LED light strip bought on ebay on to the back of some plywood to create one bi backlight. By placing a piece of acrylic with some paper taped on to it in front of it, I got a more scattered and uniform light source.\r\n\r\n\r\n\r\n[flo_control]: http://www.quantumpicture.com/Flo_Control/flo_control.htm]\r\n[raspicam_cv]: https://github.com/robidouille/robidouille/tree/master/raspicam_cv\r\n[emil_valkov]: http://www.robidouille.com/\r\n[rfid_cat]: http://www.priority1design.com.au/shopfront/index.php?main_page=product_info&cPath=1&products_id=23\r\n[rpi]: http://www.raspberrypi.org/\r\n[rpi_cam]: http://www.raspberrypi.org/archives/tag/camera-board\r\n[rpi_opencv]: https://thinkrpi.wordpress.com/2013/05/22/opencv-and-camera-board-csi/\r\n[opencv]: http://opencv.org/\r\n[picoborg]: http://www.piborg.com/picoborg","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}